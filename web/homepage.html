<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zynec Home</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
body, html {
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
  background: #000;
  overflow-x: hidden;
}

canvas {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 1;
}

.content-wrapper {
  position: relative;
  z-index: 10;
}
</style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen">

    <canvas id="sparks"></canvas>

    <div class="content-wrapper">
        <!-- Top bar with profile -->
        <div class="top-bar fixed top-0 left-0 w-full bg-gray-800 bg-opacity-80 backdrop-blur-sm p-4 flex justify-between items-center z-50 shadow-lg">
            <a href="profile.html" class="flex items-center text-gray-200 hover:text-white transition-colors">
                <div id="profile-pic-container" class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center mr-2 overflow-hidden">
                    <img id="profile-pic-img" class="w-full h-full object-cover hidden" alt="Profile">
                    <span id="profile-pic-initials" class="text-white font-bold text-lg"></span>
                </div>
                <span id="home-username" class="font-bold text-lg"></span>
            </a>
            <button onclick="logout()" class="text-white text-sm font-semibold px-4 py-2 rounded-full bg-red-600 hover:bg-red-700 transition-colors">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>

        <div class="container mx-auto mt-24 text-center px-4">
            <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-white">Welcome to Zynec!</h1>
            <p class="text-gray-400 mt-4 text-xl">Explore Communities</p>

            <div class="mt-12 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 pb-12">

                <!-- Root Community -->
                <a href="root.html" class="flex flex-col items-center justify-center p-6 bg-gray-800 bg-opacity-80 rounded-2xl shadow-xl hover:scale-105 transition-transform duration-300 ease-in-out backdrop-blur-sm">
                    <div class="w-20 h-20 rounded-full bg-gray-700 flex items-center justify-center mb-4 overflow-hidden">
                        <img src="root_icon.png" alt="Root Icon" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-semibold text-white">Root Community</div>
                </a>

                <!-- Foss Club -->
                <a href="foss.html" class="flex flex-col items-center justify-center p-6 bg-gray-800 bg-opacity-80 rounded-2xl shadow-xl hover:scale-105 transition-transform duration-300 ease-in-out backdrop-blur-sm">
                    <div class="w-20 h-20 rounded-full bg-gray-700 flex items-center justify-center mb-4 overflow-hidden">
                        <img src="foss_icon.png" alt="Foss Icon" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-semibold text-white">Foss Club</div>
                </a>

                <!-- Raise -->
                <a href="raise.html" class="flex flex-col items-center justify-center p-6 bg-gray-800 bg-opacity-80 rounded-2xl shadow-xl hover:scale-105 transition-transform duration-300 ease-in-out backdrop-blur-sm">
                    <div class="w-20 h-20 rounded-full bg-gray-700 flex items-center justify-center mb-4 overflow-hidden">
                        <img src="raise_icon.png" alt="Raise Icon" class="w-full h-full object-cover">
                    </div>
                    <div class="text-xl font-semibold text-white">Raise</div>
                </a>

            </div>
        </div>
    </div>

    <script>
        let OPT = {
            selector: "#sparks",
            amount: 5000,
            speed: 0.05,
            lifetime: 200,
            direction: {x: -0.5, y: 1},
            size: [2, 2],
            maxopacity: 1,
            color: "150, 150, 150",
            randColor: true,
            acceleration: [5, 40]
        }

        if (window.innerWidth < 520) {
            OPT.speed = 0.05;
            OPT.color = "150, 150, 150";
        }

        (function spark() {
            const canvas = document.querySelector(OPT.selector);
            const ctx = canvas.getContext("2d");

            let sparks = [];

            window.addEventListener('resize', () => {
                setCanvasWidth()
            });

            function setCanvasWidth() {
                ctx.canvas.width  = window.innerWidth;
                ctx.canvas.height = window.innerHeight;
            }

            function rand(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            function init() {
                setCanvasWidth();

                window.setInterval( () => {
                    if (sparks.length < OPT.amount) {
                        addSpark();
                    }
                }, 1000 / OPT.amount);

                window.requestAnimationFrame(draw);
            }

            function draw() {
                ctx.fillStyle = 'rgba(0,0,0, 0.1)';
                ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

                sparks.forEach( (spark, i, array) => {

                    if (spark.opacity <= 0) {
                        array.splice(i, 1);
                    } else {
                        drawSpark(spark);
                    }

                });

                window.requestAnimationFrame(draw);
            }

            function Spark(x, y) {
                this.x = x;
                this.y = y;
                this.age = 0;
                this.acceleration = rand(OPT.acceleration[0], OPT.acceleration[1]);

                this.color = OPT.randColor
                    ? rand(0,255) + "," + rand(0,255) + "," + rand(0, 255)
                    : OPT.color

                this.opacity = OPT.maxopacity - this.age / (OPT.lifetime * rand(1, 10));

                this.go = function() {
                    this.x += OPT.speed * OPT.direction.x * this.acceleration / 2
                    this.y += OPT.speed * OPT.direction.y * this.acceleration / 2

                    this.opacity = OPT.maxopacity - ++this.age / OPT.lifetime;
                }
            }

            function addSpark() {
                let x = rand(-200, window.innerWidth + 200);
                let y = rand(-200, window.innerHeight + 200);
                sparks.push(new Spark(x, y));
            }

            function drawSpark(spark) {
                let x = spark.x, y = spark.y;

                spark.go();

                ctx.beginPath();
                ctx.fillStyle = `rgba(${spark.color}, ${spark.opacity})`;
                ctx.rect(x, y, OPT.size[0], OPT.size[1], 0, 0, Math.PI * 2);
                ctx.fill();
            }

            init();
        })();

        window.onload = async function() {
            const username = localStorage.getItem('username');
            if (username) {
                document.getElementById('home-username').textContent = username;
                document.getElementById('profile-pic-initials').textContent = username[0].toUpperCase();

                // Fetch and display profile picture
                try {
                    const res = await fetch(`/api/user/${username}/profile`);
                    if (res.ok) {
                        const profile = await res.json();
                        const imgElement = document.getElementById('profile-pic-img');
                        const initialsElement = document.getElementById('profile-pic-initials');

                        if (profile.profile_pic) {
                            imgElement.src = profile.profile_pic;
                            imgElement.classList.remove('hidden');
                            initialsElement.classList.add('hidden');
                        }
                    }
                } catch (error) {
                    console.error('Error loading profile picture:', error);
                }
            } else {
                window.location.href = 'index.html';
            }
        };

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('username');
                window.location.href = 'index.html';
            }
        }
    </script>
</body>
</html>
